<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Titanium v18 Platinum</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="layout">
    
    <aside class="sidebar">
        <div class="logo">
            <i class="fas fa-layer-group"></i> <span>Titanium v18</span>
        </div>

        <div class="user-card" onclick="openModal('modalConfig')">
            <div class="avatar"><i class="fas fa-user"></i></div>
            <div class="user-info">
                <h4 id="lblProfileName">Docente</h4>
                <small data-i18n="settings">Configuraci√≥n</small>
            </div>
        </div>

        <nav class="menu">
            <p class="menu-label" data-i18n="menu_main">PRINCIPAL</p>
            <button onclick="nav('dashboard')" id="nav-dashboard" class="active">
                <i class="fas fa-home"></i> <span data-i18n="dashboard">Dashboard</span>
            </button>
            <button onclick="nav('notebook')" id="nav-notebook" class="special-btn">
                <i class="fas fa-book-journal-whills"></i> <span data-i18n="notebook">Notebook (Admin)</span>
            </button>

            <p class="menu-label" data-i18n="menu_classes">MIS CLASES</p>
            <div id="sidebarClassList"></div>
            
            <button onclick="openModal('modalClass')" class="add-btn">
                <i class="fas fa-plus"></i> <span data-i18n="new_class">Nueva Clase</span>
            </button>
        </nav>
        
        <div class="status-bar"><span id="cloudStatus">‚òÅÔ∏è Local Mode</span></div>
    </aside>

    <main class="content">

        <section id="view-dashboard" class="page active">
            <header class="page-header">
                <div>
                    <h1 data-i18n="dashboard">Dashboard</h1>
                    <p data-i18n="dash_desc">Resumen general y Alertas</p>
                </div>
            </header>

            <div class="dashboard-grid">
                <div id="dashAlerts" class="dashboard-alerts"></div>

                <div class="card full-width">
                    <div class="card-head">
                        <h3 data-i18n="weekly_schedule">Horario Semanal</h3>
                        <button onclick="openModal('modalSchedule')" class="btn-text" data-i18n="edit_schedule">Editar Horario</button>
                    </div>
                    <div class="week-grid" id="dashSchedule"></div>
                </div>

                <div class="card">
                    <h3 data-i18n="top_students">üèÜ Top Estudiantes</h3>
                    <div id="dashTopStudents" class="simple-list"></div>
                </div>

                <div class="card">
                    <h3 data-i18n="upcoming_events">üìå Eventos Pr√≥ximos</h3>
                    <div id="dashPlannerList" class="simple-list"></div>
                </div>
            </div>
        </section>

        <section id="view-notebook" class="page">
            <header class="page-header"><h1 data-i18n="global_notebook">Notebook Global</h1></header>
            
            <div class="tabs-container">
                <button class="tab active" onclick="switchNbTab('tab-nb-students')" data-i18n="tab_students">Estudiantes</button>
                <button class="tab" onclick="switchNbTab('tab-nb-rewards')" data-i18n="tab_shop">üéÅ Cat√°logo (Shop)</button>
                <button class="tab" onclick="switchNbTab('tab-nb-history')" data-i18n="tab_history">üìú Historial</button>
                <button class="tab" onclick="switchNbTab('tab-nb-gradebook')" data-i18n="tab_grades">Notas</button>
                <button class="tab" onclick="switchNbTab('tab-nb-planning')" data-i18n="tab_planning">Planning</button>
                <button class="tab" onclick="switchNbTab('tab-nb-logs')" data-i18n="tab_logs">Bit√°cora</button>
            </div>

            <div id="tab-nb-students" class="tab-content active">
                <div class="toolbar">
                    <select id="filterStudentClass" onchange="renderStudents()"></select>
                    <button onclick="openModal('modalStudent')" class="btn-primary" data-i18n="btn_add_student">+ Alumno</button>
                </div>
                <div id="studentsTable" class="table-responsive"></div>
            </div>

            <div id="tab-nb-rewards" class="tab-content">
                <div class="toolbar">
                    <button onclick="addReward()" class="btn-primary" data-i18n="btn_add_reward">+ Nueva Recompensa</button>
                </div>
                <div class="alert-box" data-i18n="shop_desc">Aqu√≠ defines los items que los alumnos pueden "comprar".</div>
                <div id="rewardsList" class="catalog-grid"></div>
            </div>

            <div id="tab-nb-history" class="tab-content">
                <div class="table-responsive">
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th data-i18n="col_date">Fecha</th>
                                <th data-i18n="col_student">Alumno</th>
                                <th data-i18n="col_reason">Raz√≥n</th>
                                <th data-i18n="col_change">Cambio</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody"></tbody>
                    </table>
                </div>
            </div>

            <div id="tab-nb-gradebook" class="tab-content">
                <div class="toolbar">
                    <select id="filterGradebookClass" onchange="renderGradebook()"></select>
                    <button onclick="openModal('modalAssignment')" class="btn-primary" data-i18n="btn_add_col">+ Columna</button>
                </div>
                <div id="gradebookContainer" class="excel-container"></div>
            </div>

            <div id="tab-nb-planning" class="tab-content">
                <div class="toolbar">
                    <button onclick="openPlanningModal()" class="btn-primary" data-i18n="btn_add_event">+ Evento</button>
                </div>
                <div id="planningGrid" class="cards-grid"></div>
            </div>

            <div id="tab-nb-logs" class="tab-content">
                <div class="toolbar">
                    <button onclick="openLogModal()" class="btn-primary" data-i18n="btn_add_log">+ Nueva Entrada</button>
                </div>
                <div id="globalLogsList" class="timeline"></div>
            </div>
        </section>

        <section id="view-class" class="page">
            <header class="page-header" id="classHeader">
                <div>
                    <h1 id="viewClassTitle">Clase</h1>
                    <p data-i18n="class_mgmt">Gesti√≥n de Aula</p>
                </div>
                <div>
                    <button onclick="deleteCurrentClass()" class="btn-danger-outline"><i class="fas fa-trash"></i> <span data-i18n="del_class">Eliminar Clase</span></button>
                </div>
            </header>

            <div class="class-cols">
                <div class="col-left">
                    <div class="card">
                        <h3 data-i18n="rewards_xp">‚≠ê Recompensas (XP)</h3>
                        <div id="classStudentGrid" class="rewards-grid"></div>
                    </div>
                    <div class="card">
                        <h3 data-i18n="grades_quick">üìä Calificaciones (Vista R√°pida)</h3>
                        <div id="classGradebookView" class="readonly-table"></div>
                    </div>
                </div>
                <div class="col-right">
                    <div class="card">
                        <div class="card-head">
                            <h3 data-i18n="logbook">üìñ Bit√°cora</h3>
                            <button onclick="openLogModal()" class="btn-text" data-i18n="add">Agregar</button>
                        </div>
                        <div id="classLogbookView" class="timeline"></div>
                    </div>
                </div>
            </div>
        </section>

    </main>
</div>

<div id="modalConfig" class="modal-overlay"><div class="modal-box">
    <h3 data-i18n="settings">Configuraci√≥n</h3>
    <label data-i18n="lbl_teacher_name">Nombre del Docente:</label>
    <input type="text" id="cfgName">
    
    <label data-i18n="lbl_language">Idioma / Language:</label>
    <select id="cfgLang">
        <option value="es">Espa√±ol</option>
        <option value="en">English</option>
    </select>

    <div class="btn-row" style="margin-top:10px;">
        <button onclick="cloudSync('pull')" class="btn-secondary" data-i18n="btn_restore">üì• Restaurar Nube</button>
        <button onclick="cloudSync('push')" class="btn-primary" data-i18n="btn_backup">üì§ Guardar en Nube</button>
    </div>
    <div class="modal-footer">
        <button onclick="saveConfig()" class="btn-primary" data-i18n="btn_save">Guardar</button>
        <button onclick="closeModal('modalConfig')" class="btn-flat" data-i18n="btn_cancel">Cancelar</button>
    </div>
</div></div>

<div id="modalClass" class="modal-overlay"><div class="modal-box">
    <h3 data-i18n="new_class">Nueva Clase</h3>
    <input type="text" id="newClassName" placeholder="Nombre (ej. Matem√°ticas / Math)">
    <div class="icon-selector" id="iconSelector"></div>
    <input type="hidden" id="selectedIcon" value="fa-chalkboard">
    <div class="color-selector" id="colorSelector"></div>
    <input type="hidden" id="selectedColor" value="#2563eb">
    <div class="modal-footer">
        <button onclick="addClass()" class="btn-primary" data-i18n="btn_create">Crear</button>
        <button onclick="closeModal('modalClass')" class="btn-flat" data-i18n="btn_cancel">Cancelar</button>
    </div>
</div></div>

<div id="modalStudent" class="modal-overlay"><div class="modal-box">
    <h3 data-i18n="new_student">Nuevo Alumno</h3>
    <input type="text" id="newStudName" placeholder="Nombre Completo">
    <select id="newStudClass"></select>
    <div class="modal-footer">
        <button onclick="addStudent()" class="btn-primary" data-i18n="btn_save">Guardar</button>
        <button onclick="closeModal('modalStudent')" class="btn-flat" data-i18n="btn_cancel">Cancelar</button>
    </div>
</div></div>

<div id="modalAssignment" class="modal-overlay"><div class="modal-box">
    <h3 data-i18n="new_assignment">Actividad</h3>
    <input type="hidden" id="assEditId"> 
    <input type="text" id="newAssTitle" placeholder="T√≠tulo / Title">
    <input type="text" id="newAssTag" placeholder="Tag (ej. P1)">
    <label data-i18n="lbl_assign_class">Asignar a Clase:</label>
    <select id="newAssClass"></select>
    <div class="modal-footer">
        <button onclick="saveAssignment()" class="btn-primary" data-i18n="btn_save">Guardar</button>
        <button onclick="closeModal('modalAssignment')" class="btn-flat" data-i18n="btn_cancel">Cancelar</button>
    </div>
</div></div>

<div id="modalPlanning" class="modal-overlay"><div class="modal-box">
    <h3 data-i18n="event_planning">Evento / Planning</h3>
    <input type="hidden" id="planEditId">
    <input type="text" id="planTitle" placeholder="T√≠tulo / Title" onkeyup="checkSmartKeywords()">
    <input type="date" id="planDate">
    <input type="text" id="planTag" placeholder="Tag">
    <label data-i18n="lbl_assign_class">Clase:</label>
    <select id="planClass"></select> <textarea id="planDesc" placeholder="Detalles..."></textarea>
    <div class="smart-link-box">
        <label>
            <input type="checkbox" id="planLinkToGradebook"> üìä <b>Smart Link:</b> <span data-i18n="create_grade">Crear nota</span>
        </label>
    </div>
    <div class="modal-footer">
        <button onclick="savePlanning()" class="btn-primary" data-i18n="btn_save">Guardar</button>
        <button onclick="closeModal('modalPlanning')" class="btn-flat" data-i18n="btn_cancel">Cancelar</button>
    </div>
</div></div>

<div id="modalLog" class="modal-overlay"><div class="modal-box">
    <h3 data-i18n="log_entry">Entrada de Bit√°cora</h3>
    <input type="hidden" id="logEditId">
    <label data-i18n="lbl_student">Alumno:</label>
    <select id="logStudent"></select>
    <label data-i18n="lbl_importance">Importancia:</label>
    <select id="logImp">
        <option value="low">üü¢ Info</option>
        <option value="medium">üü† Alerta / Warning</option>
        <option value="high">üî¥ Grave / Critical</option>
    </select>
    <textarea id="logText" rows="4" placeholder="..."></textarea>
    <div class="modal-footer">
        <button onclick="saveLog()" class="btn-primary" data-i18n="btn_save">Guardar</button>
        <button onclick="closeModal('modalLog')" class="btn-flat" data-i18n="btn_cancel">Cancelar</button>
    </div>
</div></div>

<div id="modalSchedule" class="modal-overlay"><div class="modal-box">
    <h3 data-i18n="add_schedule">Agregar al Horario</h3>
    <label data-i18n="lbl_day">D√≠a:</label>
    <select id="schDay">
        <option value="Lunes">Lunes / Monday</option>
        <option value="Martes">Martes / Tuesday</option>
        <option value="Mi√©rcoles">Mi√©rcoles / Wednesday</option>
        <option value="Jueves">Jueves / Thursday</option>
        <option value="Viernes">Viernes / Friday</option>
    </select>
    <label data-i18n="lbl_class">Clase:</label>
    <select id="schClass"></select>
    <div class="row-inputs">
        <div><label data-i18n="lbl_start">Inicio</label><input type="time" id="schStart"></div>
        <div><label data-i18n="lbl_end">Fin</label><input type="time" id="schEnd"></div>
    </div>
    <div class="modal-footer">
        <button onclick="addScheduleItem()" class="btn-primary" data-i18n="btn_add">Agregar</button>
        <button onclick="closeModal('modalSchedule')" class="btn-flat" data-i18n="btn_cancel">Cancelar</button>
    </div>
</div></div>

<div id="modalPointsManager" class="modal-overlay"><div class="modal-box">
    <h3 id="pmTitle">Manager</h3>
    <p id="pmCurrentPoints" style="color:#d97706; font-weight:bold; margin-bottom:15px; text-align:center"></p>

    <div class="points-mode-switch">
        <button class="points-mode-btn active" id="btn-mode-give" onclick="switchPointMode('give')" data-i18n="btn_give_take">Dar / Quitar</button>
        <button class="points-mode-btn" id="btn-mode-redeem" onclick="switchPointMode('redeem')" data-i18n="btn_redeem">Canjear (Shop)</button>
    </div>

    <div id="panel-give">
        <label data-i18n="lbl_amount">Cantidad:</label>
        <input type="number" id="customPoints" placeholder="0">
        <div class="quick-amounts">
            <div class="q-btn" onclick="document.getElementById('customPoints').value=5">+5</div>
            <div class="q-btn" onclick="document.getElementById('customPoints').value=10">+10</div>
            <div class="q-btn" onclick="document.getElementById('customPoints').value=20">+20</div>
            <div class="q-btn" onclick="document.getElementById('customPoints').value=-5">-5</div>
        </div>
        <label data-i18n="lbl_reason">Motivo:</label>
        <input type="text" id="pointsReason" placeholder="Ej. Participaci√≥n">
        <div class="modal-footer">
            <button onclick="applyCustomPoints()" class="btn-primary" data-i18n="btn_apply">Aplicar</button>
        </div>
    </div>

    <div id="panel-redeem" style="display:none">
        <div id="pmRedeemGrid" class="catalog-grid" style="max-height:300px; overflow-y:auto; padding:5px;"></div>
    </div>

    <div style="margin-top:15px; text-align:right">
        <button onclick="closeModal('modalPointsManager')" class="btn-flat" data-i18n="btn_close">Cerrar</button>
    </div>
</div></div>

<script src="script.js"></script>

</body>
</html>